name: "Validate Kalium References"

on:
  pull_request:
    types: [ opened, synchronize ] # Don't rerun on `edited` to save time
    paths:
      - 'kalium'

jobs:
  validate-kalium-ref:
    runs-on: ubuntu-20.04

    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          submodules: recursive # Needed in order to fetch Kalium sources for building
          fetch-depth: 0

      - name: Run git merge-base
        id: validate_kalium
        run: |
          echo "Hello world" 
          echo "diff --git a/kalium b/kalium\nindex d6a4bfc1..f9cfb85b 160000\n--- a/kalium\n+++ b/kalium\n@@ -1 +1 @@\n-Subproject commit d6a4bfc1b3b1f28047a7d0a375369730d2b6a625\n+Subproject commit f9cfb85b28fb983c420a1328952272db64d9d361" | awk '/^i/{c=NR}NR>c+2&&/^[-+]/' | awk '{split($0,words," "); print words[3];}' | xargs echo 
      
      - name: Leave a comment
        env: 
          HEAD: ${{github.head_ref}}
        if: steps.validate_kalium.is_kalium_rollback != 0
        run: |
          gh pr comment "${HEAD}" --body "@${{github.event.pull_request.user.login}} looks like you are rolling back kalium to a previous commitish. Is this intentional?"
