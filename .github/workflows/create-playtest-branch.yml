name: "Create a new Playtest branch"

on:
  schedule:
    - cron: '30 2 * * THU' # every Thursday at 02:30 UTC
  workflow_dispatch:
    inputs:
      playtest-branch-manual-name:
        description: 'A name for a playtest/$name branch'
        required: true

jobs:
  create-playtest-branch:
    runs-on: ubuntu-latest
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - uses: actions/checkout@v3
        with:
          ref: develop
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y-%m-%d')"
      - name: Manually create a named playtest branch
        uses: peterjgrainger/action-create-branch@v2.2.0
        if: ${{ github.event.inputs.playtest-branch-manual-name }}  
        env:
          PLAYTEST_BRANCH_NAME: playtest/${{ github.event.inputs.playtest-branch-manual-name }}
        with:
          branch: ${{env.PLAYTEST_BRANCH_NAME}}
      - name: Automatically Create a named playtest branch
        uses: peterjgrainger/action-create-branch@v2.2.0
        if: "${{ github.event.inputs.playtest-branch-manual-name == '' }}"
        env:
          PLAYTEST_BRANCH_NAME: playtest/${{ steps.date.outputs.date }}
        with:
          branch: ${{env.PLAYTEST_BRANCH_NAME}}
      - name: Notify on Wire
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: "**PLAYTEST BRANCH CREATED** ${{env.PLAYTEST_BRANCH_NAME}} ðŸš€ - Hotfixes only"
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.WIRE_ANDROID_TEAM_WEBHOOK_URL }}
  
