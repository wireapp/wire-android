name: "Crowdin Action"

# **What it does**: Upload strings to crowdin project for translations and creates a PR when new updates.
# **Why we have it**: We want to externalize and automate the translations process.
# **Who does it impact**: Everyone collaborating on the project.
# For more info: https://github.com/crowdin/github-action/blob/master/action.yml

on:
    push:
        branches: [ develop ]

    workflow_dispatch:

concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

jobs:
    synchronize-with-crowdin:
        runs-on: ubuntu-latest

        steps:
            -   name: Checkout
                uses: actions/checkout@v3

            -   name: Crowdin action
                uses: crowdin/github-action@1.12.0
                with:
                    project_id: ${{ secrets.CROWDIN_PROJECT_ID }}
                    token: ${{ secrets.CROWDIN_API_TOKEN }}

                    upload_sources: true
                    download_translations: true
                    upload_translations: false

                    create_pull_request: true
                    localization_branch_name: chore/sync-and-update-localization
                    commit_message: "chore: update localization strings via Crowdin"
                    pull_request_title: "chore: update localization strings via Crowdin"
                    pull_request_body: "This PR pulls in the latest localization translations from Crowdin."
                    github_user_name: "zebot"
                    github_user_email: "zebot@users.noreply.github.com"

                    pull_request_labels: "l10n, crowdin"
                    pull_request_assignees: "crowdin-bot"
                    pull_request_team_reviewers: "android"

                    source: "/app/src/main/res/values/strings.xml"
                    translation: "/app/src/main/res/values-%two_letters_code%/%original_file_name%"

                env:
                    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
